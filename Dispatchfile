#!takirala/dispatch-cue:v0.4-beta1

resource "dispatch-git": {
  type: "git"
  param url: "$(context.git.url)"
  param revision: "6b505dfef8a4b6aee6385f122317ac5eb5947cf5"
}

task "build": {
  inputs: ["dispatch-git"]
  steps: [
    {
      name: "build"
      image: "golang:1.13.0-buster"
      command: [ "go", "build", "main.go" ]
      env: [ { name: "GO111MODULE", value: "off" } ]
      workingDir: "/workspace/dispatch-git"
    }
  ]
}

actions: [
  {
    tasks: ["build"]
  },
  {
    name: "daily-build"
    tasks: ["build"]
    on: cron: schedule: "@daily"
  }
]